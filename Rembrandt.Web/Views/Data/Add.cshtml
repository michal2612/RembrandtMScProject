@model Rembrandt.Contracts.Classes.Dataset.ObservationDto
@{
    ViewData["Title"] = "Add";
}
<h1>@ViewData["Title"]</h1>
<p>Use this page to detail your site's privacy policy.</p>
<div class="row">
    <div class="col-3">
        <div class="nav flex-column nav-pills" id="v-pills-tab" role="tablist" aria-orientation="vertical">
            <a class="nav-link active" id="v-pills-general-tab" data-toggle="pill" href="#v-pills-general" role="tab" aria-controls="v-pills-general" aria-selected="true">General</a>
                <a class="nav-link" id="v-pills-attributes-tab" data-toggle="pill" href="#v-pills-attributes" role="tab" aria-controls="v-pills-attributes" aria-selected="false">Attributes</a>
                <a class="nav-link" id="v-pills-activities-tab" data-toggle="pill" href="#v-pills-activities" role="tab" aria-controls="v-pills-activities" aria-selected="false">Activities</a>
                <a class="nav-link" id="v-pills-submit-tab" data-toggle="pill" href="#v-pills-submit" role="tab" aria-controls="v-pills-submit" aria-selected="false" onclick="submit()">Submit</a>
        </div>
    </div>
    <div class="col-9">
        <div class="tab-content" id="v-pills-tabContent">
            <div class="tab-pane fade show active" id="v-pills-general" role="tabpanel" aria-labelledby="v-pills-general-tab">
                <div id="general">
                    <div class="form-group">
                        <label for="siteId">Select location ID</label>
                        <select class="form-control" id="siteId">
                            @for(int i =0; i<= 30; i++)
                            {
                                <option>@i</option>
                            }
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="PhotoAddress">Photo of location:</label>
                        <input type="file" class="form-control-file" id="photoLocation">
                    </div>
                    <div id="map">
                    </div>
                    <div id="coordinates">
                        <table class="table table-striped table-hover ">
                            <tr>
                                <td>Location:</td>
                                <td></td>
                            </tr>
                            <tr>
                                <td>Latitude</td>
                                <td id="latitude-value"></td>
                            </tr>
                            <tr>
                                <td>Longitude</td>
                                <td id="longitude-value"></td>
                            </tr>
                        </table>
                    </div>
                </div>
            </div>
            <div class="tab-pane fade" id="v-pills-attributes" role="tabpanel" aria-labelledby="v-pills-attributes-tab">
                @foreach(var property in @Model.Attributes.GetType().GetProperties())
                {
                    <div class="form-group">
                        <b>@property.Name</b>
                        <input type="range" class="form-control-range" id="@property.Name" min="0" max="10" value="5" name="attribute">
                    </div>
                }
            </div>
            <div class="tab-pane fade" id="v-pills-activities" role="tabpanel" aria-labelledby="v-pills-activities-tab">
                <table class="table table-striped table-hover">
                    <tr>
                        <td style="font-size: large">Is this area suitable for:</td>
                        <td></td>
                        <td></td>
                        <td></td>
                    </tr>
                    @foreach(var property in @Model.Activities.GetType().GetProperties())
                    {
                    <tr>
                        <td>@property.Name?</td>
                        <td>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" value="null" name="@property.Name" checked aria-checked="true">
                                <label class="form-check-label" for="@property.Name">No opinion</label>
                            </div>
                        </td>
                        <td>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" value="true" name="@property.Name">
                                <label class="form-check-label" for="@property.Name">Suitable</label>
                            </div>
                        </td>
                        <td>
                            <div class="form-check form-check-inline">
                                <input class="form-check-input" type="radio" value="false" name="@property.Name">
                                <label class="form-check-label" for="@property.Name">Not Suitable</label>
                            </div>
                        </td>
                    </tr>
                    }
                </table>
            </div>
            <div class="tab-pane fade" id="v-pills-submit" role="tabpanel" aria-labelledby="v-pills-settings-tab">
                <a href="#" class="btn btn-primary btn-lg active" role="button" aria-pressed="true">Submit</a>
            </div>
        </div>
    </div>
</div>

@section scripts {
    <script>
        function submit() {

            var observation = new Object();

            //side id
            observation["siteId"] = document.getElementById("siteId").value;

            //attributes
            var attributes = document.getElementsByName('attribute');
            for(var item of attributes) {
                observation[item.id] = item.value;
            }

            //activities
            var activities = document.getElementsByTagName('input');
            for(i=0; i < activities.length; i++) {
                if(activities[i].type == 'radio' && activities[i].checked) {
                    observation[activities[i].name] = activities[i].value;
                }
            }
        }

        //map
        let map;
        var markers = [];

        function addMarker(latLng) {
            let marker = new google.maps.Marker({
                map: map,
                position: latLng,
                draggable: true
            });
            document.getElementById('latitude-value').innerHTML = marker.position.lat().toFixed(6);
            document.getElementById('longitude-value').innerHTML = marker.position.lng().toFixed(6);
            markers.push(marker);
        };

        function initMap() {
            map = new google.maps.Map(document.getElementById('map'), {
            center: {lat: 52.3633995, lng: 4.8459126},
            zoom: 15
        });

        map.addListener('click', function(e) {
            setMapOnAll(null)
            addMarker(e.latLng);
            });
        }

        function setMapOnAll(map) {
            for (var i = 0; i < markers.length; i++) {
                markers[i].setMap(map);
            }
        }
    </script>
    <script src="https://polyfill.io/v3/polyfill.min.js?features=default"></script>
    <script async defer
        src="https://maps.googleapis.com/maps/api/js?key=AIzaSyDgpHpnK2Fgy1xVldrfRrcZHds8Yrr-Kik&callback=initMap&libraries=&v=weekly">
    </script>
}